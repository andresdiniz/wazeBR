    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <style>
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            font-weight: 500;
            background-color: #f8f9fa;
        }
        .summary-item {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
        }
        .summary-value {
            font-size: 24px;
            font-weight: bold;
        }
        .summary-label {
            font-size: 14px;
            color: #6c757d;
        }
        .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }
        #hourlyChart, #weekdayChart, #levelChart, #monthlyChart, 
        #cityChart, #roadTypeChart, #delayDistChart, #lengthVsDelayChart {
            height: 300px;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <h1 class="mb-4">Dashboard de Análise de Congestionamentos</h1>
        
        <!-- Nav tabs para principais análises -->
        <ul class="nav nav-tabs mb-4" id="analysisTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Visão Geral</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="segments-tab" data-bs-toggle="tab" data-bs-target="#segments" type="button" role="tab" aria-controls="segments" aria-selected="false">Segmentos</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="time-tab" data-bs-toggle="tab" data-bs-target="#time" type="button" role="tab" aria-controls="time" aria-selected="false">Análise Temporal</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="geography-tab" data-bs-toggle="tab" data-bs-target="#geography" type="button" role="tab" aria-controls="geography" aria-selected="false">Geografia</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="false">Detalhes</button>
            </li>
        </ul>
        
        <!-- Tab content -->
        <div class="tab-content" id="analysisTabContent">
            <!-- Visão Geral -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                <div class="row">
                    <!-- Cartões de resumo -->
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Resumo dos Congestionamentos</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-3 col-md-6">
                                        <div class="summary-item text-center">
                                            <div class="summary-value">{{ analytics['resumo']['total']|number_format }}</div>
                                            <div class="summary-label">Congestionamentos Totais</div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="summary-item text-center">
                                            <div class="summary-value">{{ (analytics['resumo']['atraso_medio']/60)|number_format(1) }}</div>
                                            <div class="summary-label">Atraso Médio (minutos)</div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="summary-item text-center">
                                            <div class="summary-value">{{ (analytics['resumo']['comprimento_medio']/1000)|number_format(2) }}</div>
                                            <div class="summary-label">Comprimento Médio (km)</div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="summary-item text-center">
                                            <div class="summary-value">{{ (analytics['resumo']['max_atraso']/60)|number_format(1) }}</div>
                                            <div class="summary-label">Maior Atraso em Minutos</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráfico de distribuição por hora -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Distribuição por Hora do Dia</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="hourlyChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráfico de distribuição por dia da semana -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Distribuição por Dia da Semana</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="weekdayChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráfico de nível de congestionamento -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Congestionamentos por Nível</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="levelChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Distribuição de atrasos -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Distribuição de Atrasos</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="delayDistChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Segmentos -->
            <div class="tab-pane fade" id="segments" role="tabpanel" aria-labelledby="segments-tab">
                <div class="row">
                    <!-- Top Segmentos -->
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Segmentos Mais Congestionados</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>ID Segmento</th>
                                                <th>Contagem</th>
                                                <th>Atraso Médio (min)</th>
                                                <th>Comprimento Médio (m)</th>
                                                <th>Atraso Máx (min)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for segment in data.top_segments %}
                                            <tr>
                                                <td>{{ segment.ID_segment }}</td>
                                                <td>{{ segment.jam_count }}</td>
                                                <td>{{ (segment.avg_delay/60)|number_format(1) }}</td>
                                                <td>{{ segment.avg_length|number_format(0) }}</td>
                                                <td>{{ (segment.max_delay/60)|number_format(1) }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Ruas -->
                    <div class="col-md-12 mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Ruas Mais Problemáticas</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Rua</th>
                                                <th>Contagem</th>
                                                <th>Atraso Médio (min)</th>
                                                <th>Comprimento Médio (m)</th>
                                                <th>Atraso Máx (min)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for street in data.top_streets %}
                                            <tr>
                                                <td>{{ street.street }}</td>
                                                <td>{{ street.jam_count }}</td>
                                                <td>{{ (street.avg_delay/60)|number_format(1) }}</td>
                                                <td>{{ street.avg_length|number_format(0) }}</td>
                                                <td>{{ (street.max_delay/60)|number_format(1) }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Relação Tamanho vs Atraso -->
                    <div class="col-md-12 mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Relação entre Comprimento e Atraso</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="lengthVsDelayChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Análise Temporal -->
            <div class="tab-pane fade" id="time" role="tabpanel" aria-labelledby="time-tab">
                <div class="row">
                    <!-- Tendência Mensal -->
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Tendência Mensal de Congestionamentos</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="monthlyChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela detalhe horário -->
                    <div class="col-md-6 mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Detalhes por Hora do Dia</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Hora</th>
                                                <th>Congestionamentos</th>
                                                <th>Atraso Médio (min)</th>
                                                <th>Velocidade Média (km/h)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for hour in data.hourly_distribution %}
                                            <tr>
                                                <td>{{ hour.hour_of_day }}:00</td>
                                                <td>{{ hour.jam_count }}</td>
                                                <td>{{ (hour.avg_delay/60)|number_format(1) }}</td>
                                                <td>{{ hour.avg_speed|number_format(1) }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela detalhe semanal -->
                    <div class="col-md-6 mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Detalhes por Dia da Semana</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Dia</th>
                                                <th>Congestionamentos</th>
                                                <th>Atraso Médio (min)</th>
                                                <th>Comprimento Médio (m)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for day in data.weekly_pattern %}
                                            <tr>
                                                <td>{{ day.day_of_week }}</td>
                                                <td>{{ day.jam_count }}</td>
                                                <td>{{ (day.avg_delay/60)|number_format(1) }}</td>
                                                <td>{{ day.avg_length|number_format(0) }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Geografia -->
            <div class="tab-pane fade" id="geography" role="tabpanel" aria-labelledby="geography-tab">
                <div class="row">
                    <!-- Cidades -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Congestionamentos por Cidade</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="cityChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tipo de Via -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Congestionamentos por Tipo de Via</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="roadTypeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela detalhe de cidades -->
                    <div class="col-md-12 mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Detalhes por Cidade</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Cidade</th>
                                                <th>Congestionamentos</th>
                                                <th>Atraso Médio (min)</th>
                                                <th>Velocidade Média (km/h)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for city in data.city_analysis %}
                                            <tr>
                                                <td>{{ city.city }}</td>
                                                <td>{{ city.jam_count }}</td>
                                                <td>{{ (city.avg_delay/60)|number_format(1) }}</td>
                                                <td>{{ city.avg_speed|number_format(1) }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Detalhes -->
            <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
                <div class="row">
                    <!-- Congestionamentos Recentes -->
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Congestionamentos Recentes</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Rua</th>
                                                <th>Cidade</th>
                                                <th>Nível</th>
                                                <th>Atraso (min)</th>
                                                <th>Comprimento (m)</th>
                                                <th>Velocidade (km/h)</th>
                                                <th>Data</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for jam in data.recent_jams %}
                                            <tr>
                                                <td>{{ jam.uuid|slice(0, 8) }}...</td>
                                                <td>{{ jam.street }}</td>
                                                <td>{{ jam.city }}</td>
                                                <td>{{ jam.level }}</td>
                                                <td>{{ (jam.delay/60)|number_format(1) }}</td>
                                                <td>{{ jam.length|number_format(0) }}</td>
                                                <td>{{ jam.speedKMH|number_format(1) }}</td>
                                                <td>{{ jam.date_received }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle com Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Adicione antes do fechamento do body -->
    <script>
    // Converta os dados para JSON no console
    console.log('Dados do Dashboard:', {{ dataresumo|json_encode|raw }});
    </script>
    
    <!-- Script para dashboard -->
    <script>
        // Dados para gráficos extraídos da variável PHP
        const dashboardData = {{analytics|json_encode|raw}};
    </script>
    <script src="../js/traffic-dashboard.js"></script>
</body>
</html>