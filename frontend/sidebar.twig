<body id="page-top">

<!-- Wrapper Principal -->
<div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav sidebar" id="accordionSidebar">

        <!-- Brand / Logo -->
        <a class="sidebar-brand" href="/home">
            <div class="sidebar-brand-icon">
                <img src="{{ settings.logo }}" alt="{{ settings.systemname }}">
            </div>
            <div class="sidebar-brand-text">{{ settings.systemname }}</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0">

        <!-- Container de conteúdo scrollável -->
        <div class="sidebar-scrollable-content" style="flex: 1; overflow-y: auto; overflow-x: hidden;">

        <!-- Nav Item - Dashboard -->
        <li class="nav-item {{ pagedata.current_page == 'dashboard' ? 'active' : '' }}">
            <a class="nav-link" href="dashboard" data-tooltip="Dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
            <i class="fas fa-broadcast-tower"></i>
            Dados ao Vivo
        </div>

        <!-- Nav Item - Rotas -->
        <li class="nav-item {{ pagedata.current_page in ['routes', 'irregularidades', 'mapa_tempo_real', 'rastreamento'] ? 'active' : '' }}">
            <a class="nav-link" href="#" 
            data-bs-toggle="collapse" 
            data-bs-target="#collapseLiveRoutes"
            data-tooltip="Rotas"
            aria-expanded="{{ pagedata.current_page in ['routes', 'irregularidades', 'mapa_tempo_real', 'rastreamento'] ? 'true' : 'false' }}">
                <i class="fas fa-route"></i>
                <span>Rotas</span>
            </a>

            <div id="collapseLiveRoutes" 
                class="collapse {{ pagedata.current_page in ['routes', 'irregularidades', 'mapa_tempo_real', 'rastreamento'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-road"></i>
                        Opções de Rotas
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'routes' ? 'active' : '' }}" href="routes">
                        <i class="fas fa-list"></i> Todas as Rotas
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'mapa_tempo_real' ? 'active' : '' }}" href="mapa_tempo_real">
                        <i class="fas fa-map-marked-alt"></i> Mapa em Tempo Real
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'irregularidades' ? 'active' : '' }}" href="irregularidades">
                        <i class="fas fa-exclamation-triangle"></i> Irregularidades
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'rastreamento' ? 'active' : '' }}" href="rastreamento">
                        <i class="fas fa-location-arrow"></i> Rastreamento de Veículos
                    </a>
                </div>
            </div>
        </li>

        <!-- Nav Item - Tráfego -->
        <li class="nav-item {{ pagedata.current_page in ['trafego_atual', 'congestionamentos', 'fluxo_veiculos'] ? 'active' : '' }}">
            <a class="nav-link" href="#" 
            data-bs-toggle="collapse" 
            data-bs-target="#collapseLiveTraffic"
            data-tooltip="Tráfego"
            aria-expanded="{{ pagedata.current_page in ['trafego_atual', 'congestionamentos', 'fluxo_veiculos'] ? 'true' : 'false' }}">
                <i class="fas fa-traffic-light"></i>
                <span>Tráfego</span>
            </a>

            <div id="collapseLiveTraffic" 
                class="collapse {{ pagedata.current_page in ['trafego_atual', 'congestionamentos', 'fluxo_veiculos'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-car"></i>
                        Monitoramento de Tráfego
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'trafego_atual' ? 'active' : '' }}" href="trafego_atual">
                        <i class="fas fa-chart-line"></i> Tráfego Atual
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'congestionamentos' ? 'active' : '' }}" href="congestionamentos">
                        <i class="fas fa-stop-circle"></i> Congestionamentos
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'fluxo_veiculos' ? 'active' : '' }}" href="fluxo_veiculos">
                        <i class="fas fa-exchange-alt"></i> Fluxo de Veículos
                    </a>
                </div>
            </div>
        </li>

        <!-- Nav Item - Alertas -->
        <li class="nav-item {{ pagedata.current_page in ['alertas_ativos', 'acidentes', 'obras', 'perigos'] ? 'active' : '' }}">
            <a class="nav-link" href="#" 
            data-bs-toggle="collapse" 
            data-bs-target="#collapseLiveAlerts"
            data-tooltip="Alertas"
            aria-expanded="{{ pagedata.current_page in ['alertas_ativos', 'acidentes', 'obras', 'perigos'] ? 'true' : 'false' }}">
                <i class="fas fa-exclamation-circle"></i>
                <span>Alertas</span>
            </a>

            <div id="collapseLiveAlerts" 
                class="collapse {{ pagedata.current_page in ['alertas_ativos', 'acidentes', 'obras', 'perigos'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-bell"></i>
                        Alertas em Tempo Real
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'alertas_ativos' ? 'active' : '' }}" href="alertas_ativos">
                        <i class="fas fa-bell-on"></i> Alertas Ativos
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'acidentes' ? 'active' : '' }}" href="acidentes">
                        <i class="fas fa-car-crash"></i> Acidentes
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'obras' ? 'active' : '' }}" href="obras">
                        <i class="fas fa-hard-hat"></i> Obras
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'perigos' ? 'active' : '' }}" href="perigos">
                        <i class="fas fa-radiation"></i> Perigos na Via
                    </a>
                </div>
            </div>
        </li>

        <hr class="sidebar-divider">

        <div class="sidebar-heading">
            <i class="fa-regular fa-chart-bar"></i>
            Dados Estatísticos
        </div>

        <!-- Nav Item - Dados das Rotas -->
        <li class="nav-item {{ pagedata.current_page in ['analise_tempos', 'irregularidades_stats', 'comparativo_rotas', 'velocidade_media'] ? 'active' : '' }}">
            <a class="nav-link" href="#"
            data-bs-toggle="collapse"
            data-bs-target="#collapseStatsRoutes"
            data-tooltip="Dados das Rotas"
            aria-expanded="{{ pagedata.current_page in ['analise_tempos', 'irregularidades_stats', 'comparativo_rotas', 'velocidade_media'] ? 'true' : 'false' }}">
                <i class="fas fa-route"></i>
                <span>Dados das Rotas</span>
            </a>

            <div id="collapseStatsRoutes"
                class="collapse {{ pagedata.current_page in ['analise_tempos', 'irregularidades_stats', 'comparativo_rotas', 'velocidade_media'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-road"></i>
                        Análises de Rotas
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'analise_tempos' ? 'active' : '' }}" href="analise_tempos">
                        <i class="fas fa-clock"></i> Análise de Tempos
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'velocidade_media' ? 'active' : '' }}" href="velocidade_media">
                        <i class="fas fa-tachometer-alt"></i> Velocidade Média
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'comparativo_rotas' ? 'active' : '' }}" href="comparativo_rotas">
                        <i class="fas fa-balance-scale"></i> Comparativo de Rotas
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'irregularidades_stats' ? 'active' : '' }}" href="irregularidades_stats">
                        <i class="fas fa-exclamation-triangle"></i> Irregularidades
                    </a>
                </div>
            </div>
        </li>

        <!-- Nav Item - Dados dos Alertas -->
        <li class="nav-item {{ pagedata.current_page in ['historic_acidents', 'historic_buracos', 'mapa_calor', 'tendencias'] ? 'active' : '' }}">
            <a class="nav-link" href="#"
            data-bs-toggle="collapse"
            data-bs-target="#collapseStatsAlerts"
            data-tooltip="Dados dos Alertas"
            aria-expanded="{{ pagedata.current_page in ['historic_acidents', 'historic_buracos', 'mapa_calor', 'tendencias'] ? 'true' : 'false' }}">
                <i class="fas fa-exclamation-circle"></i>
                <span>Dados dos Alertas</span>
            </a>

            <div id="collapseStatsAlerts"
                class="collapse {{ pagedata.current_page in ['historic_acidents', 'historic_buracos', 'mapa_calor', 'tendencias'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-bell"></i>
                        Histórico de Alertas
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'historic_acidents' ? 'active' : '' }}" href="historic_acidents">
                        <i class="fas fa-car-crash"></i> Acidentes Históricos
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'historic_buracos' ? 'active' : '' }}" href="historic_buracos">
                        <i class="fas fa-road"></i> Buracos Históricos
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'mapa_calor' ? 'active' : '' }}" href="mapa_calor">
                        <i class="fas fa-fire"></i> Mapa de Calor
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'tendencias' ? 'active' : '' }}" href="tendencias">
                        <i class="fas fa-chart-area"></i> Tendências
                    </a>
                </div>
            </div>
        </li>

        <!-- Nav Item - Relatórios -->
        <li class="nav-item {{ pagedata.current_page in ['relatorios_mensais', 'relatorios_anuais', 'exportar_dados', 'dashboards_personalizados'] ? 'active' : '' }}">
            <a class="nav-link" href="#"
            data-bs-toggle="collapse"
            data-bs-target="#collapseStatsReports"
            data-tooltip="Relatórios"
            aria-expanded="{{ pagedata.current_page in ['relatorios_mensais', 'relatorios_anuais', 'exportar_dados', 'dashboards_personalizados'] ? 'true' : 'false' }}">
                <i class="fas fa-file-alt"></i>
                <span>Relatórios</span>
            </a>

            <div id="collapseStatsReports"
                class="collapse {{ pagedata.current_page in ['relatorios_mensais', 'relatorios_anuais', 'exportar_dados', 'dashboards_personalizados'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-clipboard-list"></i>
                        Relatórios e Exportações
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'relatorios_mensais' ? 'active' : '' }}" href="relatorios_mensais">
                        <i class="fas fa-calendar-alt"></i> Relatórios Mensais
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'relatorios_anuais' ? 'active' : '' }}" href="relatorios_anuais">
                        <i class="fas fa-calendar"></i> Relatórios Anuais
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'exportar_dados' ? 'active' : '' }}" href="exportar_dados">
                        <i class="fas fa-download"></i> Exportar Dados
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'dashboards_personalizados' ? 'active' : '' }}" href="dashboards_personalizados">
                        <i class="fas fa-chart-pie"></i> Dashboards Personalizados
                    </a>
                </div>
            </div>
        </li>

        <!-- Divisor visual do menu -->
        <hr class="sidebar-divider">

        <!-- Título da seção de configurações -->
        <div class="sidebar-heading">
            <i class="fas fa-cog"></i>
            Configurações
        </div>

        <!-- ITEM: Configurações do Sistema -->
        <li class="nav-item {{ pagedata.current_page in ['settings_gerais', 'settings_irregularidades', 'settings_notificacoes', 'settings_integracao'] ? 'active' : '' }}">
            <a class="nav-link" href="#"
            data-bs-toggle="collapse"
            data-bs-target="#collapseSystemSettings"
            data-tooltip="Configurações do Sistema"
            aria-expanded="{{ pagedata.current_page in ['settings_gerais', 'settings_irregularidades', 'settings_notificacoes', 'settings_integracao'] ? 'true' : 'false' }}">
                <i class="fas fa-wrench"></i>
                <span>Configurações do Sistema</span>
            </a>

            <div id="collapseSystemSettings"
                class="collapse {{ pagedata.current_page in ['settings_gerais', 'settings_irregularidades', 'settings_notificacoes', 'settings_integracao'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-tools"></i>
                        Opções do Sistema
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'settings_gerais' ? 'active' : '' }}" href="settings_gerais">
                        <i class="fas fa-sliders-h"></i> Configurações Gerais
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'settings_irregularidades' ? 'active' : '' }}" href="settings_irregularidades">
                        <i class="fas fa-exclamation-triangle"></i> Gerenciar Irregularidades
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'settings_notificacoes' ? 'active' : '' }}" href="settings_notificacoes">
                        <i class="fas fa-bell"></i> Notificações
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'settings_integracao' ? 'active' : '' }}" href="settings_integracao">
                        <i class="fas fa-plug"></i> Integrações
                    </a>
                </div>
            </div>
        </li>

        <!-- ITEM: Usuários e Permissões -->
        <li class="nav-item {{ pagedata.current_page in ['usuarios', 'perfis', 'logs_acesso', 'auditoria'] ? 'active' : '' }}">
            <a class="nav-link" href="#"
            data-bs-toggle="collapse"
            data-bs-target="#collapseUsers"
            data-tooltip="Usuários"
            aria-expanded="{{ pagedata.current_page in ['usuarios', 'perfis', 'logs_acesso', 'auditoria'] ? 'true' : 'false' }}">
                <i class="fas fa-users"></i>
                <span>Usuários</span>
            </a>

            <div id="collapseUsers"
                class="collapse {{ pagedata.current_page in ['usuarios', 'perfis', 'logs_acesso', 'auditoria'] ? 'show' : '' }}">
                <div class="collapse-inner">
                    <h6 class="collapse-header">
                        <i class="fas fa-user-cog"></i>
                        Gerenciamento de Usuários
                    </h6>

                    <a class="collapse-item {{ pagedata.current_page == 'usuarios' ? 'active' : '' }}" href="usuarios">
                        <i class="fas fa-user-friends"></i> Gerenciar Usuários
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'perfis' ? 'active' : '' }}" href="perfis">
                        <i class="fas fa-id-card"></i> Perfis e Permissões
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'logs_acesso' ? 'active' : '' }}" href="logs_acesso">
                        <i class="fas fa-history"></i> Logs de Acesso
                    </a>

                    <a class="collapse-item {{ pagedata.current_page == 'auditoria' ? 'active' : '' }}" href="auditoria">
                        <i class="fas fa-shield-alt"></i> Auditoria
                    </a>
                </div>
            </div>
        </li>

        
        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block">

        <!-- Sidebar Toggle -->
        <div class="sidebar-toggle-wrapper d-none d-md-block">
            <button id="sidebarToggle"></button>
        </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Overlay para mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Content Wrapper -->
    <div id="content-wrapper">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <nav class="topbar">

                <!-- Sidebar Toggle (Mobile) -->
                <button id="sidebarToggleTop" class="d-md-none">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- Topbar Info -->
                <div class="topbar-info d-none d-sm-flex ms-3">
                    <i class="fas fa-clock"></i>
                    <span id="currentDateTime"></span>
                </div>
                
                <!-- Topbar Navbar -->
                div class="topbar-spacer">
                <ul class="navbar-nav ms-auto">

                    <!-- Notifications -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" 
                        data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bell fa-fw"></i>
                            <span class="badge rounded-pill bg-danger notification-badge">3+</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end shadow animated--grow-in" aria-labelledby="alertsDropdown">
                            <h6 class="dropdown-header">
                                <i class="fas fa-bell me-2"></i>
                                Centro de Notificações
                            </h6>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="me-3">
                                    <div class="icon-circle bg-primary">
                                        <i class="fas fa-file-alt text-white"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="small text-muted">12 de Dezembro, 2024</div>
                                    <span class="fw-bold">Novo relatório disponível</span>
                                </div>
                            </a>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="me-3">
                                    <div class="icon-circle bg-success">
                                        <i class="fas fa-donate text-white"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="small text-muted">11 de Dezembro, 2024</div>
                                    <span class="fw-bold">Sistema atualizado com sucesso</span>
                                </div>
                            </a>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="me-3">
                                    <div class="icon-circle bg-warning">
                                        <i class="fas fa-exclamation-triangle text-white"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="small text-muted">10 de Dezembro, 2024</div>
                                    <span class="fw-bold">Alerta: Pico de congestionamentos</span>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-center text-primary" href="#">
                                <strong>Ver Todas as Notificações</strong>
                            </a>
                        </div>
                    </li>

                    <div class="topbar-divider d-none d-sm-block"></div>

                    <!-- User Menu -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle user-link" href="#" id="userDropdown" 
                        data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="me-2 d-none d-lg-inline user-name">{{ user.nome }}</span>
                            <div class="user-avatar">
                                <img src="{{ user.photo }}" alt="Foto do Usuário">
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">
                            <h6 class="dropdown-header">
                                <i class="fas fa-user me-2"></i>
                                Minha Conta
                            </h6>
                            <a class="dropdown-item" href="perfil">
                                <i class="fas fa-user me-2"></i>
                                Perfil
                            </a>
                            <a class="dropdown-item" href="configuracoes">
                                <i class="fas fa-cogs me-2"></i>
                                Configurações
                            </a>
                            <a class="dropdown-item" href="notificacoes">
                                <i class="fas fa-bell me-2"></i>
                                Notificações
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="ajuda">
                                <i class="fas fa-question-circle me-2"></i>
                                Ajuda
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href="#" data-bs-toggle="modal" data-bs-target="#logoutModal">
                                <i class="fas fa-sign-out-alt me-2"></i>
                                Sair
                            </a>
                        </div>
                    </li>

                </ul>

            </nav>
            </div>
            <!-- End of Topbar -->