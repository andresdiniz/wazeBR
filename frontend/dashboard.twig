<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
            <i class="fas fa-download fa-sm text-white-50"></i> Exportar Dados
        </a>
    </div>

    <!-- Metrics Row -->
    <div class="row">
        {% set metrics = [
            {title: 'Alertas Ativos', value: activeAlertsToday, color: 'primary', icon: 'calendar'},
            {title: 'Alertas Totais (Mês)', value: totalAlertsThisMonth, color: 'success', icon: 'dollar-sign'},
            {title: 'Alertas Confirmados', value: '50.00%', color: 'info', icon: 'clipboard-list', progress: 50},
            {title: 'Alertas Não Confirmados', value: '18.00', color: 'warning', icon: 'comments'},
            {title: 'KMs de congestionamento', value: traficdata.total_kms_lento, color: 'primary', icon: 'calendar'},
            {title: 'Tempos de Atraso', value: traficdata.total_atraso_minutos ~ ' min', color: 'primary', icon: 'calendar'}
        ] %}
        
        {% for metric in metrics %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card border-left-{{ metric.color }} shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-{{ metric.color }} text-uppercase mb-1">
                                {{ metric.title }}
                            </div>
                            {% if metric.progress is defined %}
                            <div class="row no-gutters align-items-center">
                                <div class="col-auto">
                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{ metric.value }}</div>
                                </div>
                                <div class="col">
                                    <div class="progress progress-sm mr-2">
                                        <div class="progress-bar bg-{{ metric.color }}" role="progressbar" 
                                             style="width: {{ metric.progress }}%" 
                                             aria-valuenow="{{ metric.progress }}" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ metric.value }}</div>
                            {% endif %}
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-{{ metric.icon }} fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Charts Row -->
    <div class="row">
        {% set charts = [
            {type: 'Acidentes', data: accidentAlerts, color: 'primary'},
            {type: 'Buracos', data: hazardAlerts, color: 'primary'}
        ] %}
        
        {% for chart in charts %}
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-{{ chart.color }}">{{ chart.type }}</h6>
                    {% include 'components/dropdown_menu.html.twig' %}
                </div>
                <div class="card-body">
                    {% if chart.data is not empty %}
                        {% include 'components/alerts_table.html.twig' with {alerts: chart.data} %}
                    {% else %}
                        <p>Não há eventos de {{ chart.type|lower }} registrados no momento.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Additional Content Row -->
    <div class="row">
        {% set additionalCards = [
            {type: 'Congestionamentos', data: jamAlerts, color: 'primary'},
            {type: 'Outros Alertas', data: otherAlerts, color: 'primary', columns: 6}
        ] %}
        
        {% for card in additionalCards %}
        <div class="col-lg-{{ card.columns|default(6) }} mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-{{ card.color }}">{{ card.type }}</h6>
                </div>
                <div class="card-body">
                    {% if card.data is not empty %}
                        {% include 'components/alerts_table.html.twig' with {
                            alerts: card.data,
                            extraColumns: card.type == 'Outros Alertas' ? ['Tipo', 'Subtipo'] : []
                        } %}
                    {% else %}
                        <p>Não há alertas de {{ card.type|lower }} registrados no momento.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

</div>
<!-- /.container-fluid -->

{% include 'components/alert_modal.html.twig' %}

<!-- External Resources -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.dataTables.min.css">

<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>

<script src="./js/scripts.js"></script>