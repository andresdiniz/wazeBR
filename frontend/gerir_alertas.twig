
<body>
    <div class="container mt-4">
        <h2>Lista de Eventos</h2>
        <select id="statusFilter" class="form-select w-25 mb-3">
            <option value="1" selected>Ativos</option>
            <option value="2">Inativos</option>
        </select>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Descrição</th>
                    <th>Rua</th>
                    <th>Direção</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="eventTable">
                <tr>
                    <td colspan="6" class="text-center">Carregando...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Modal de Edição -->
    <div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editEventLabel">Editar Evento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editEventForm">
                        <input type="hidden" id="editEventId">
                        <div class="mb-3">
                            <label for="editDescription" class="form-label">Descrição</label>
                            <textarea class="form-control" id="editDescription"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editStatus" class="form-label">Status</label>
                            <select class="form-select" id="editStatus">
                                <option value="1">Ativo</option>
                                <option value="2">Inativo</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const eventTable = document.getElementById("eventTable");
            const statusFilter = document.getElementById("statusFilter");

            function loadEvents() {
                fetch(`get_events.php?status=${statusFilter.value}`)
                    .then(response => response.json())
                    .then(events => {
                        eventTable.innerHTML = events.map(event => `
                            <tr>
                                <td>${event.id}</td>
                                <td>${event.description}</td>
                                <td>${event.street}</td>
                                <td>${event.direction}</td>
                                <td>${event.is_active == '1' ? 'Ativo' : 'Inativo'}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="editEvent(${event.id}, '${event.description}', '${event.is_active}')">Editar</button>
                                </td>
                            </tr>
                        `).join("");
                    });
            }

            function editEvent(id, description, is_active) {
                document.getElementById("editEventId").value = id;
                document.getElementById("editDescription").value = description;
                document.getElementById("editStatus").value = is_active;
                new bootstrap.Modal(document.getElementById("editEventModal")).show();
            }

            document.getElementById("editEventForm").addEventListener("submit", (e) => {
                e.preventDefault();
                const id = document.getElementById("editEventId").value;
                const description = document.getElementById("editDescription").value;
                const is_active = document.getElementById("editStatus").value;

                fetch("update_event.php", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `id=${id}&description=${encodeURIComponent(description)}&is_active=${is_active}`
                })
                .then(response => response.json())
                .then(() => {
                    loadEvents();
                    bootstrap.Modal.getInstance(document.getElementById("editEventModal")).hide();
                });
            });

            statusFilter.addEventListener("change", loadEvents);
            loadEvents();
        });
    </script>
