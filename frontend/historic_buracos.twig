<!-- Tabela de Buracos Corrigida -->
<div class="card shadow">
    <div class="card-body">
        <div class="table-responsive">
            <table id="buracosTable" class="table table-striped table-hover w-100">
                <thead>
                    <tr>
                        <th>Localização</th>
                        <th>Confiança</th>
                        <th>Data</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for buraco in buracos %}
                    <tr data-uuid="{{ buraco.uuid }}">
                        <td>
                            {% if buraco.street %}
                                {{ buraco.city }}, {{ buraco.street }}
                            {% else %}
                                {{ buraco.city }} (Sem endereço)
                            {% endif %}
                        </td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                {% set percent = (buraco.confidence * 20) %}
                                <div class="progress-bar 
                                    {% if percent >= 80 %}bg-success
                                    {% elseif percent >= 60 %}bg-warning
                                    {% else %}bg-danger{% endif %}" 
                                     style="width: {{ percent }}%">
                                    {{ percent }}%
                                </div>
                            </div>
                        </td>
                        <td>{{ (buraco.pubMillis / 1000)|date("d/m/Y H:i") }}</td>
                        <td>
                            <button class="btn btn-sm btn-info btn-edit" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#editModal">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center text-muted py-4">
                                Nenhum registro encontrado
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Adicione esses links no cabeçalho -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.bootstrap5.min.css">

<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.bootstrap5.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>

<script>
// Resolver conflitos de jQuery
var jq = $.noConflict();

jq(document).ready(function() {
    // Inicializar DataTable
    const table = jq('#buracosTable').DataTable({
        dom: 'Bfrtip',
        buttons: [
            {
                extend: 'excelHtml5',
                text: '<i class="fas fa-file-excel"></i> Excel',
                className: 'btn btn-success',
                exportOptions: {
                    columns: [0, 1, 2]
                }
            },
            {
                extend: 'csvHtml5',
                text: '<i class="fas fa-file-csv"></i> CSV',
                className: 'btn btn-primary',
                exportOptions: {
                    columns: [0, 1, 2]
                }
            }
        ],
        language: {
            url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/pt-BR.json'
        },
        columnDefs: [
            { orderable: false, targets: 3 } // Desabilitar ordenação na coluna de ações
        ]
    });

    // Configuração do modal com DataTables
    jq('#editModal').on('show.bs.modal', function(e) {
        const button = jq(e.relatedTarget);
        const row = button.closest('tr');
        const uuid = row.data('uuid');

        // Implementar lógica para buscar coordenadas via AJAX se necessário
        console.log('UUID selecionado:', uuid);
        
        // Exemplo de implementação do mapa (ajuste com dados reais)
        if(map) map.remove();
        map = L.map('map').setView([-20.6694, -43.7899], 15); // Coordenadas exemplo
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        if(marker) marker.remove();
        marker = L.marker([-20.6694, -43.7899]).addTo(map); // Marcador exemplo
    });

    // Redimensionar mapa quando o modal é aberto
    jq('#editModal').on('shown.bs.modal', function() {
        if(map) map.invalidateSize();
    });
});
</script>

<!-- Restante do código do modal permanece igual -->