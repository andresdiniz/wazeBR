<div class="container-fluid">
    <!-- Card de Filtros -->
    <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white py-3">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filtros Avançados</h5>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <!-- Filtro de Período -->
                <div class="col-12 col-md-6 col-lg-3">
                    <label class="form-label text-muted small mb-1">Período</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                        <select id="filter-period" class="form-select">
                            <option value="">Todo o Período</option>
                            <option value="7">Últimos 7 dias</option>
                            <option value="15">Últimos 15 dias</option>
                            <option value="30">Últimos 30 dias</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                </div>

                <!-- Filtro de Data Personalizada -->
                <div class="col-12 col-md-6 col-lg-3" id="custom-date-filter" style="display: none;">
                    <label class="form-label text-muted small mb-1">Data Personalizada</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-calendar-week"></i></span>
                        <input type="date" id="filter-start-date" class="form-control" placeholder="Início">
                        <input type="date" id="filter-end-date" class="form-control" placeholder="Fim">
                    </div>
                </div>

                <!-- Filtro de Localização -->
                <div class="col-12 col-md-6 col-lg-3">
                    <label class="form-label text-muted small mb-1">Localização</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                        <input type="text" id="filter-city" class="form-control" placeholder="Cidade">
                        <input type="text" id="filter-street" class="form-control" placeholder="Rua">
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="col-12 col-md-6 col-lg-3 d-flex align-items-end">
                    <button id="reset-filters" class="btn btn-outline-secondary me-2">
                        <i class="fas fa-undo me-1"></i>Limpar
                    </button>
                    <button id="export-btn" class="btn btn-success">
                        <i class="fas fa-file-export me-1"></i>Exportar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cards de Estatísticas -->
    <div class="row mb-4">
        <div class="col-12 col-md-4 mb-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body py-3">
                    <h5 class="card-title"><i class="fas fa-check-circle me-2"></i>Ativos</h5>
                    <h2 id="count-active" class="mb-0">0</h2>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4 mb-3">
            <div class="card bg-danger text-white h-100">
                <div class="card-body py-3">
                    <h5 class="card-title"><i class="fas fa-times-circle me-2"></i>Inativos</h5>
                    <h2 id="count-inactive" class="mb-0">0</h2>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4 mb-3">
            <div class="card bg-info text-white h-100">
                <div class="card-body py-3">
                    <h5 class="card-title"><i class="fas fa-filter me-2"></i>Filtrados</h5>
                    <h2 id="count-filtered" class="mb-0">0</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabela Responsiva -->
    <div class="card shadow">
        <div class="card-body">
            <div class="table-responsive">
                <table id="buracos-table" class="table table-striped table-hover w-100">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>País</th>
                            <th>Cidade</th>
                            <th>Rua</th>
                            <th>Confiança</th>
                            <th>Data</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for buraco in bburacos %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ buraco.country }}</td>
                                <td>{{ buraco.city }}</td>
                                <td>{{ buraco.street }}</td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-{{ buraco.confidence|confidence_color }}" 
                                             role="progressbar" 
                                             style="width: {{ buraco.confidence }}%"
                                             aria-valuenow="{{ buraco.confidence }}" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                            {{ buraco.confidence }}%
                                        </div>
                                    </div>
                                </td>
                                <td data-order="{{ buraco.pubMillis }}">
                                    {{ buraco.pubMillis|date("d/m/Y H:i") }}
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-sm btn-success resolve-btn" 
                                                data-uuid="{{ buraco.uuid }}"
                                                data-bs-toggle="tooltip"
                                                title="Marcar como resolvido">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger delete-btn" 
                                                data-uuid="{{ buraco.uuid }}"
                                                data-bs-toggle="tooltip" 
                                                title="Reportar como inexistente">
                                            <i class="fas fa-times"></i>
                                        </button>
                                        <button class="btn btn-sm btn-info info-btn" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#detailModal"
                                                data-uuid="{{ buraco.uuid }}"
                                                title="Ver detalhes">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="7" class="text-center py-4">
                                    <div class="alert alert-warning mb-0">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        Nenhum registro encontrado
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <!-- Conteúdo do modal -->
</div>

<!-- Modal de Detalhes -->
<div class="modal fade" id="detailModal" tabindex="-1">
    <!-- Conteúdo do modal -->
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"></script>
<script>
    $(document).ready(function() {
        // Inicialização do DataTable com extensões
        var table = $('#buracos-table').DataTable({
            dom: 'Bfrtip',
            buttons: [
                {
                    extend: 'excelHtml5',
                    text: '<i class="fas fa-file-excel me-2"></i>Excel',
                    className: 'btn btn-success'
                },
                {
                    extend: 'csvHtml5',
                    text: '<i class="fas fa-file-csv me-2"></i>CSV',
                    className: 'btn btn-primary'
                }
            ],
            responsive: true,
            order: [[5, 'desc']],
            language: {
                url: '//cdn.datatables.net/plug-ins/1.13.1/i18n/pt-BR.json'
            }
        });

        // Função para atualizar os contadores
        function updateCounters() {
            const total = table.rows().count();
            const filtered = table.rows({ search: 'applied' }).count();
            
            $('#count-active').text(total);
            $('#count-filtered').text(filtered);
            $('#count-inactive').text(total - filtered);
        }

        // Sistema de Filtros Avançados
        function filterTable() {
            // Lógica de filtragem aprimorada
        }

        // Event Listeners
        $('#filter-period').change(function() {
            // Lógica para período personalizado
        });

        $('#reset-filters').click(function() {
            // Lógica para resetar filtros
        });

        // Sistema de Confirmação de Ações
        $('.resolve-btn, .delete-btn').click(function() {
            // Lógica para exibir modal de confirmação
        });

        // Inicialização de Tooltips
        $('[data-bs-toggle="tooltip"]').tooltip();

        // Atualização inicial dos contadores
        updateCounters();
        table.on('draw', updateCounters);
    });
</script>