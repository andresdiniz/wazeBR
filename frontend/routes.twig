<!-- Begin Page Content -->
<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h2 class="h3 mb-0 text-gray-800">ROTAS</h2>
    </div>

    <!-- Content Row -->
    <div class="row">
        {% if routes is not empty %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Nome da Rota</th>
                        <th>Início</th>
                        <th>Fim</th>
                        <th class="d-none d-md-table-cell">Vel. Normal (km/h)</th>
                        <th class="d-none d-md-table-cell">Tempo Normal (min)</th>
                        <th>Vel. Atual (km/h)</th>
                        <th>Tempo Atual (min)</th>
                        <th>Atraso (min)</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for route in routes %}
                    <tr data-uuid="{{ route.id }}" class="{% if route.avg_time - route.historic_time > 0 %}delay-row{% else %}on-time-row{% endif %}">
                        <td data-toggle="tooltip" title="{{ route.name }}" class="route-name">{{ route.name }}</td>
                        <td data-toggle="tooltip" title="{{ route.from_name }}" class="route-details">{{ route.from_name }}</td>
                        <td data-toggle="tooltip" title="{{ route.to_name }}" class="route-details">{{ route.to_name }}</td>
                        <td class="d-none d-md-table-cell" data-toggle="tooltip" title="{{ route.historic_speed|number_format(2) }} Km/h">{{ route.historic_speed|number_format(2) }} Km/h</td>
                        <td class="d-none d-md-table-cell" data-toggle="tooltip" title="{{ (route.historic_time / 60)|number_format(2) }} min">{{ (route.historic_time / 60)|number_format(2) }} min</td>
                        <td data-toggle="tooltip" title="{{ route.avg_speed|number_format(2) }} Km/h">{{ route.avg_speed|number_format(2) }} Km/h</td>
                        <td data-toggle="tooltip" title="{{ (route.avg_time / 60)|number_format(2) }} min">{{ (route.avg_time / 60)|number_format(2) }} min</td>
                        <td data-toggle="tooltip" title="{{ ((route.avg_time - route.historic_time) / 60)|number_format(2) }} min">{{ ((route.avg_time - route.historic_time) / 60)|number_format(2) }} min</td>
                        <td>
                            <button class="btn btn-info btn-sm view-route"
                                data-toggle="mapModal"
                                data-target="#mapModal"
                                data-route-id="{{ route.id }}"
                                data-toggle="tooltip" title="Ver mais detalhes da rota">
                                VER +
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>Não há eventos de acidentes registrados no momento.</p>
        {% endif %}
    </div>
</div>

<div id="loadingIndicator" style="display: none; text-align: center; font-size: 1.2em; color: gray;">
    <p>Carregando rota...</p>
</div>

<div class="modal-body row">
    <!-- Mapa -->
    <div class="col-md-8">
        <div id="mapContainer" class="rounded border" style="height: 500px;"></div>
    </div>
    
    <!-- Sidebar de Informações -->
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <h6 class="card-title text-muted">ESTATÍSTICAS</h6>
                
                <div class="d-flex justify-content-between mb-3">
                    <div>
                        <small class="text-muted">Velocidade Atual</small>
                        <h4 class="text-primary">{{ route.avg_speed|number_format(1) }} km/h</h4>
                    </div>
                    <div class="text-end">
                        <small class="text-muted">Velocidade Histórica</small>
                        <h4 class="text-secondary">{{ route.historic_speed|number_format(1) }} km/h</h4>
                    </div>
                </div>

                <div class="progress mb-4" style="height: 8px;">
                    <div class="progress-bar bg-warning" 
                         style="width: {{ ((route.avg_speed / route.historic_speed) * 100)|min(100) }}%">
                    </div>
                </div>

                <h6 class="mt-4"><i class="fas fa-exclamation-triangle text-danger"></i> Irregularidades</h6>
                <ul class="list-group">
                    {% for point in irregularidades %}
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Ponto {{ loop.index }}</span>
                        <span class="text-muted">{{ point.x|number_format(5) }}, {{ point.y|number_format(5) }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<script src="./js/scripts-routes.js"></script>
<script>
    // Inicializa os tooltips no documento
    $(document).ready(function() {
        // Ativar tooltips
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>
