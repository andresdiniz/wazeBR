<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Rotas</title>
    <style>
        /* Estilos básicos para visualização (você pode substituir por seu CSS/Framework) */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Rotas do Parceiro ID: {{ id_parceiro }}</h1>

    {# Verifica se a lista de rotas está vazia #}
    {% if routes is empty %}
        <p>Nenhuma rota encontrada para o seu parceiro.</p>
    {% else %}
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Origem</th>
                    <th>Destino</th>
                    <th>Vel. Histórica</th>
                    <th>Tempo Histórico</th>
                    <th>Vel. Média</th>
                    <th>Tempo Médio</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {# Itera sobre a variável 'routes' que o PHP enviou #}
                {% for route in routes %}
                    <tr>
                        {# Acessando as propriedades de cada rota #}
                        <td>{{ route.id }}</td>
                        <td>{{ route.name }}</td>
                        <td>{{ route.from_name }}</td>
                        <td>{{ route.to_name }}</td>
                        <td>{{ route.historic_speed }}</td>
                        <td>{{ route.historic_time }}</td>
                        <td>{{ route.avg_speed }}</td>
                        <td>{{ route.avg_time }}</td>
                        <td>
                            {# O botão chama uma função JavaScript passando o ID da rota para carregar os detalhes (otimização do modal) #}
                            <button 
                                class="btn-detalhes" 
                                onclick="fetchRouteDetails({{ route.id }})"
                            >
                                Detalhes
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    <hr>

    {# Modal de Exemplo para exibir os detalhes carregados por AJAX #}
    <div id="route-modal" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; border: 2px solid black; padding: 30px; z-index: 1000;">
        <h2>Detalhes da Rota: <span id="modal-route-name"></span></h2>
        <p>ID: <span id="modal-route-id"></span></p>
        <p>Velocidade Histórica: <span id="modal-historic-speed"></span></p>
        <p>Tempo Histórico: <span id="modal-historic-time"></span></p>
        <p>Destino: <span id="modal-to-name"></span></p>
        
        {# O modal exibirá todos os campos retornados pela função getRouteDetails() #}
        
        <button onclick="document.getElementById('route-modal').style.display='none'">Fechar</button>
    </div>

    {# Lógica JavaScript para Carregar Dados do Modal via AJAX #}
    <script>
        function fetchRouteDetails(routeId) {
            // Faz a requisição para o novo endpoint 'details' que retorna apenas os dados da rota solicitada
            fetch(`/routes.php?action=details&id=${routeId}`)
                .then(response => {
                    // Verifica se a requisição foi bem-sucedida
                    if (!response.ok) {
                        throw new Error('A resposta da rede não foi satisfatória.');
                    }
                    return response.json();
                })
                .then(data => {
                    // Preenche os elementos do modal com os dados retornados
                    document.getElementById('modal-route-name').textContent = data.name || 'N/A';
                    document.getElementById('modal-route-id').textContent = data.id || 'N/A';
                    document.getElementById('modal-historic-speed').textContent = data.historic_speed || 'N/A';
                    document.getElementById('modal-historic-time').textContent = data.historic_time || 'N/A';
                    document.getElementById('modal-to-name').textContent = data.to_name || 'N/A';
                    
                    // Exibe o modal
                    document.getElementById('route-modal').style.display = 'block';
                })
                .catch(error => {
                    console.error('Erro ao carregar detalhes da rota:', error);
                    alert('Não foi possível carregar os detalhes da rota.');
                });
        }
    </script>
</body>
</html>